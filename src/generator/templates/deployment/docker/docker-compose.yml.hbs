# AssembleJS Docker Compose Configuration # Generated by RIVET - AssembleJS
Enterprise Deployment System version: '3.8' services: app: build: context: .
dockerfile: Dockerfile restart: always user: "node" ports: - "{{projectPort}}:{{projectPort}}"
environment: NODE_ENV: production volumes: - assemblejs-uploads:/app/uploads
{{#if (eq configLevel "advanced")}}
  - assemblejs-logs:/app/logs - assemblejs-cache:/app/cache
{{/if}}
networks: - assembly-network healthcheck: test: ["CMD", "wget", "-qO-",
"http://localhost:{{projectPort}}/health"] interval: 30s timeout: 3s retries: 3

{{#if useNginx}}
  nginx: image: nginx:alpine restart: always ports: - "80:80" - "443:443"
  volumes: - ./deploy/nginx/nginx.conf:/etc/nginx/conf.d/default.conf -
  ./deploy/nginx/ssl:/etc/nginx/ssl depends_on: - app networks: -
  assembly-network
{{/if}}

{{#if includeDatabase}}
  {{databaseType}}: image:
  {{#if (eq databaseType "postgres")}}postgres:14-alpine{{/if}}{{#if
    (eq databaseType "mysql")
  }}mysql:8{{/if}}{{#if (eq databaseType "mongodb")}}mongo:5{{/if}}
  restart: always environment:
  {{#if (eq databaseType "postgres")}}
    POSTGRES_USER: ${DB_USER:-assemblejs} POSTGRES_PASSWORD:
    ${DB_PASSWORD:-assemblejs_password} POSTGRES_DB: ${DB_NAME:-assemblejs_db}
  {{/if}}
  {{#if (eq databaseType "mysql")}}
    MYSQL_ROOT_PASSWORD: ${DB_ROOT_PASSWORD:-root_password} MYSQL_USER:
    ${DB_USER:-assemblejs} MYSQL_PASSWORD: ${DB_PASSWORD:-assemblejs_password}
    MYSQL_DATABASE: ${DB_NAME:-assemblejs_db}
  {{/if}}
  {{#if (eq databaseType "mongodb")}}
    MONGO_INITDB_ROOT_USERNAME: ${DB_USER:-assemblejs}
    MONGO_INITDB_ROOT_PASSWORD: ${DB_PASSWORD:-assemblejs_password}
  {{/if}}
  volumes: - assemblejs-db-data:/var/lib/{{#if
    (eq databaseType "postgres")
  }}postgresql/data{{/if}}{{#if (eq databaseType "mysql")}}mysql{{/if}}{{#if
    (eq databaseType "mongodb")
  }}mongodb{{/if}}
  networks: - assembly-network
{{/if}}

networks: assembly-network: driver: bridge # Define all persistent volumes
volumes:
{{#if includeDatabase}}
  assemblejs-db-data: driver: local
{{/if}}
assemblejs-uploads: driver: local
{{#if (eq configLevel "advanced")}}
  assemblejs-cache: driver: local assemblejs-logs: driver: local
{{/if}}