/* Infinity stone styling */
.infinity-stone {
  position: absolute;
  width: 14px;
  height: 14px;
  border-radius: 50%;
  cursor: pointer;
  box-shadow: 0 0 5px currentColor, inset 0 0 4px rgba(255, 255, 255, 0.7);
  transition: all 0.3s ease;
  opacity: 0.15;
  z-index: 9999;
  animation: pulse 3s infinite ease-in-out;
  animation-play-state: running;
  pointer-events: auto !important;
}

.infinity-stone:hover {
  transform: scale(1.2);
  opacity: 0.7;
}

.infinity-stone.collected {
  opacity: 0.5;
  animation: collected-pulse 1.5s infinite ease-in-out;
}

@keyframes pulse {
  0% {
    transform: scale(1);
    opacity: 0.1;
    box-shadow: 0 0 3px currentColor, inset 0 0 3px rgba(255, 255, 255, 0.5);
  }
  50% {
    transform: scale(1.5);
    opacity: 0.6;
    box-shadow: 0 0 12px currentColor, inset 0 0 8px rgba(255, 255, 255, 0.9);
  }
  100% {
    transform: scale(1);
    opacity: 0.1;
    box-shadow: 0 0 3px currentColor, inset 0 0 3px rgba(255, 255, 255, 0.5);
  }
}

@keyframes collected-pulse {
  0% {
    transform: scale(1);
    opacity: 0.5;
  }
  50% {
    transform: scale(1.3);
    opacity: 0.8;
  }
  100% {
    transform: scale(1);
    opacity: 0.5;
  }
}

/* Stone ripple effect */
.stone-ripple {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: 9998;
  opacity: 0;
  transition: opacity 0.8s ease-out;
}

.stone-ripple.active {
  opacity: 0;
  animation: ripple-fade 2s forwards cubic-bezier(0.22, 0.61, 0.36, 1);
}

@keyframes ripple-fade {
  0% {
    opacity: 0;
  }
  20% {
    opacity: 0.4;
  }
  80% {
    opacity: 0.3;
  }
  100% {
    opacity: 0;
  }
}

/* Stone collection counter */
.stone-counter {
  position: fixed;
  bottom: 20px;
  right: 20px;
  background: rgba(0, 0, 0, 0.8);
  color: white;
  padding: 8px 16px;
  border-radius: 20px;
  font-size: 14px;
  z-index: 9997;
  opacity: 0;
  transform: translateY(20px);
  transition: opacity 0.5s ease, transform 0.5s ease;
  pointer-events: none;
}

.stone-counter.active {
  opacity: 1;
  transform: translateY(0);
}

.stone-counter.hidden {
  opacity: 0;
  transform: translateY(20px);
  transition: opacity 0.5s ease, transform 0.5s ease;
}

.infinity-stone.space {
  background-color: #1E88E5;
  background: radial-gradient(circle at center, #1E88E5 40%, #1565C0 100%);
  filter: drop-shadow(0 0 10px rgba(30, 136, 229, 0.9));
  z-index: 10000;
}

.infinity-stone.reality {
  background-color: #E53935;
  background: radial-gradient(circle at center, #E53935 40%, #C62828 100%);
  filter: drop-shadow(0 0 10px rgba(229, 57, 53, 0.9));
}

.infinity-stone.power {
  background-color: #8E24AA;
  background: radial-gradient(circle at center, #8E24AA 40%, #6A1B9A 100%);
  filter: drop-shadow(0 0 10px rgba(142, 36, 170, 0.9));
}

.infinity-stone.mind {
  background-color: #FDD835;
  background: radial-gradient(circle at center, #FDD835 40%, #F9A825 100%);
  filter: drop-shadow(0 0 10px rgba(253, 216, 53, 0.9));
  z-index: 10000;
  width: 16px;
  height: 16px;
  opacity: 0.3;
}

.infinity-stone.time {
  background-color: #00897B;
  background: radial-gradient(circle at center, #00897B 40%, #00695C 100%);
  filter: drop-shadow(0 0 10px rgba(0, 137, 123, 0.9));
}

.infinity-stone.soul {
  background-color: #FB8C00;
  background: radial-gradient(circle at center, #FB8C00 40%, #EF6C00 100%);
  filter: drop-shadow(0 0 10px rgba(251, 140, 0, 0.9));
}

/* Snap effect - respects theme */
.snap-effect {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: var(--bg); /* Uses theme variable for background */
  overflow: hidden;
  z-index: 9999;
  opacity: 0;
  visibility: hidden;
  transition: opacity 1.5s ease;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  padding: 2rem;
}

.snap-effect.active {
  opacity: 1;
  visibility: visible;
}

/* Floating stones in the snap effect */
.floating-stones-container {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: 1;
  overflow: hidden;
}

.bouncing-stone {
  position: absolute;
  width: 40px;
  height: 40px;
  border-radius: 50%;
  animation: bounce 20s infinite both;
  opacity: 0.8;
  transform: translateZ(0);
  will-change: transform, left, top;
}

/* For the bouncing animation, we're using a mixture of CSS animations and direct style properties */
@keyframes bounce {
  0%, 100% {
    animation-timing-function: ease-in-out;
  }
  /* Each stone moves in a different pattern based on its base position, 
     which is set in JS with random positions */
  20% {
    transform: translate(calc(-150px + 300px * Math.random()), 
                       calc(-150px + 300px * Math.random())) 
               rotate(72deg);
  }
  40% {
    transform: translate(calc(-150px + 300px * Math.random()), 
                       calc(-150px + 300px * Math.random())) 
               rotate(144deg);
  }
  60% {
    transform: translate(calc(-150px + 300px * Math.random()), 
                       calc(-150px + 300px * Math.random())) 
               rotate(216deg);
  }
  80% {
    transform: translate(calc(-150px + 300px * Math.random()), 
                       calc(-150px + 300px * Math.random())) 
               rotate(288deg);
  }
  100% {
    transform: translate(0, 0) rotate(360deg);
  }
}

/* Balance message - respects theme */
.balance-message {
  font-size: 2.2rem;
  color: var(--text); /* Uses theme text color */
  text-align: center;
  margin-bottom: 1rem;
  font-weight: 300;
  letter-spacing: 0.05em;
  max-width: 800px;
  opacity: 0;
  transform: translateY(10px);
  animation: fade-in 0.8s forwards 0.5s;
  text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
  z-index: 10;
  position: relative;
}

.balance-submessage {
  font-size: 1.2rem;
  color: var(--text-secondary); /* Uses theme secondary text color */
  text-align: center;
  margin-bottom: 2.5rem;
  font-weight: 300;
  max-width: 600px;
  opacity: 0;
  transform: translateY(10px);
  animation: fade-in 0.8s forwards 1s;
  text-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
  z-index: 10;
  position: relative;
}

@keyframes fade-in {
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* ASSEMBLE Button styling with Dr Strange portal effect */
.assemble-button {
  padding: 1.2rem 2.5rem;
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: white;
  border-radius: 50px;
  cursor: pointer;
  font-size: 1.2rem;
  font-weight: 700;
  /* Make button fade in initially but be visible */
  opacity: 0.7;
  transform: translateY(0);
  /* Slower animation to ensure it's visible during stabilization */
  animation: initial-fade-in 0.8s forwards;
  letter-spacing: 0.1em;
  box-shadow: 0 0 20px rgba(255, 255, 255, 0.1), 
              0 0 40px rgba(70, 131, 180, 0.1), 
              inset 0 0 15px rgba(70, 131, 180, 0.1);
  position: relative;
  overflow: visible;
  backdrop-filter: blur(5px);
  z-index: 10;
  transition: all 0.3s ease;
  display: inline-block; /* Ensure proper display */
}

@keyframes initial-fade-in {
  0% {
    opacity: 0;
    transform: translateY(20px);
  }
  100% {
    opacity: 0.7;
    transform: translateY(0);
  }
}

/* Disabled button state */
.assemble-button.disabled {
  cursor: wait;
  opacity: 0.7;
  background: rgba(255, 255, 255, 0.05);
  box-shadow: 0 0 10px rgba(255, 255, 255, 0.05);
  color: rgba(255, 255, 255, 0.7);
}

/* Ready button animation */
.assemble-button.button-ready {
  animation: none !important; /* Clear any previous animations */
  animation: button-ready-pulse 2s infinite alternate ease-in-out !important;
  opacity: 1 !important;
  transform: translateY(0) !important;
}

@keyframes button-ready-pulse {
  0% {
    box-shadow: 0 0 20px rgba(255, 255, 255, 0.2),
                0 0 40px rgba(70, 131, 180, 0.1);
  }
  100% {
    box-shadow: 0 0 30px rgba(255, 255, 255, 0.3),
                0 0 50px rgba(70, 131, 180, 0.2),
                0 0 70px rgba(255, 140, 0, 0.1);
  }
}

/* Base glow behind button */
.assemble-button::before {
  content: '';
  position: absolute;
  top: -2px;
  left: -2px;
  right: -2px;
  bottom: -2px;
  border-radius: 50px;
  background: linear-gradient(45deg, #1E88E5, #E53935, #8E24AA, #FDD835, #00897B, #FB8C00);
  background-size: 400% 400%;
  z-index: -1;
  animation: gradient-shift 10s ease infinite;
  opacity: 0.4;
  transition: all 0.5s ease;
}

/* Removed the oblong outer ring */

@keyframes gradient-shift {
  0% {
    background-position: 0% 50%;
  }
  50% {
    background-position: 100% 50%;
  }
  100% {
    background-position: 0% 50%;
  }
}

/* Portal ring animation */
@keyframes portal-spin {
  0% {
    transform: rotate(0deg);
    box-shadow: 0 0 20px #FB8C00, inset 0 0 30px #FB8C00;
  }
  50% {
    transform: rotate(180deg);
    box-shadow: 0 0 40px #FB8C00, inset 0 0 60px #FB8C00;
  }
  100% {
    transform: rotate(360deg);
    box-shadow: 0 0 20px #FB8C00, inset 0 0 30px #FB8C00;
  }
}

/* Portal sparks animation */
@keyframes sparks {
  0%, 100% {
    opacity: 0;
    transform: scale(0) rotate(0deg);
  }
  50% {
    opacity: 1;
    transform: scale(1) rotate(180deg);
  }
}

/* Dr Strange portal hover effect */
.assemble-button:hover {
  background: rgba(255, 255, 255, 0.2);
  box-shadow: 0 0 30px rgba(255, 255, 255, 0.5),
              0 0 60px rgba(255, 140, 0, 0.4);
  transform: translateY(-3px) scale(1.05);
}

/* Removed activation of portal ring */

/* Create portal effect on hover */
.assemble-button:hover::before {
  opacity: 0.8;
  filter: blur(8px);
  transform: scale(1.1);
}

/* Show portal circle on hover */
.assemble-button:hover .portal-circle {
  opacity: 1;
  transform: translate(-50%, -50%) scale(1); /* Full size of the defined width/height */
}

.assemble-button:active {
  transform: scale(0.98);
}

/* Dr. Strange portal circle */
.assemble-button .portal-circle {
  position: absolute;
  top: 50%;
  left: 50%;
  width: calc(100% + 120px);
  height: 0;
  padding-bottom: calc(100% + 120px); /* Makes it a perfect circle */
  border-radius: 50%; /* Perfect circle */
  background: transparent; /* Transparent background to allow image to fade out */
  border: 4px solid #FB8C00;
  box-shadow: 
    0 0 30px #FB8C00,
    inset 0 0 40px #FB8C00;
  transform: translate(-50%, -50%) scale(0);
  opacity: 0;
  pointer-events: none;
  transition: all 0.5s ease;
  z-index: 100;
  overflow: hidden;
}

/* View through the portal */
.assemble-button .portal-view {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  border-radius: 50%; /* Perfect circle */
  opacity: 1; /* Full opacity */
  overflow: hidden;
  background-color: transparent; /* No background to allow fading to transparency */
  /* Subtle inner shadow for depth but allows transparency */
  box-shadow: 
    inset 0 0 25px 20px rgba(0, 0, 0, 0.2);
}

/* Create a home page view with image */
.assemble-button .portal-home-view {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  overflow: hidden;
  border-radius: 50%;
  /* Moderate zoom for fisheye effect and to hide edges during movement */
  transform: scale(1.25); /* Balanced zoom level - not too close, not too far */
}

/* Container for the portal image - dark mode by default */
.portal-image-container {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-image: url('../../assets/images/portal-image.png'); /* Dark mode image */
  background-position: center center;
  background-size: cover; /* Cover ensures no squishing while filling container */
  background-repeat: no-repeat;
  animation: portal-image-float 32s infinite ease-in-out; /* 4x slower */
  filter: saturate(1.2); /* Slightly boost colors */
  /* Add mask for fading edges to transparent */
  -webkit-mask-image: radial-gradient(circle at center, black 50%, transparent 85%);
  mask-image: radial-gradient(circle at center, black 50%, transparent 85%);
}

/* Light mode variant for the portal image */
.portal-image-container.light-mode-image {
  background-image: url('../../assets/images/portal-image-light.png'); /* Light mode image */
}

/* Spinning outer ring of the portal */
.assemble-button .portal-circle::before {
  content: '';
  position: absolute;
  top: -10px;
  left: -10px;
  right: -10px;
  bottom: -10px;
  border-radius: 50%;
  border: 6px solid transparent;
  border-top: 6px solid rgba(255, 140, 0, 0.9);
  border-left: 6px solid rgba(255, 140, 0, 0.6);
  border-right: 6px solid rgba(255, 140, 0, 0.9);
  border-bottom: 6px solid rgba(255, 140, 0, 0.6);
  box-shadow: 
    0 0 25px rgba(255, 140, 0, 0.6), 
    inset 0 0 15px rgba(255, 140, 0, 0.6);
  animation: portal-ring-spin 20s linear infinite; /* 4x slower */
  z-index: 2;
}

/* Second spinning ring */
.assemble-button .portal-circle::after {
  content: '';
  position: absolute;
  top: -20px;
  left: -20px;
  right: -20px;
  bottom: -20px;
  border-radius: 50%;
  border: 3px dashed rgba(255, 180, 0, 0.8);
  box-shadow: 
    inset 0 0 20px 5px rgba(255, 140, 0, 0.5),
    0 0 15px 3px rgba(255, 140, 0, 0.5);
  transform: rotate(45deg);
  animation: portal-ring-spin-reverse 48s linear infinite; /* 4x slower */
  z-index: 1;
}

/* Animation for the portal image floating - smaller movement to prevent edge visibility */
@keyframes portal-image-float {
  0% {
    transform: translate(0%, 0%);
  }
  20% {
    transform: translate(2%, -1.5%);
  }
  40% {
    transform: translate(-2%, 3%);
  }
  60% {
    transform: translate(-3%, -2%);
  }
  80% {
    transform: translate(1.5%, 3%);
  }
  100% {
    transform: translate(0%, 0%);
  }
}

/* Animation for the portal ring */
@keyframes portal-ring-spin {
  0% {
    transform: rotate(0deg);
  }
  100% {
    transform: rotate(360deg);
  }
}

/* Portal particles and sparks */
@keyframes portal-particles {
  0%, 100% {
    box-shadow: 
      0 0 0 2px rgba(255, 140, 0, 0.1),
      0 0 0 4px rgba(255, 140, 0, 0.1),
      0 0 0 8px rgba(255, 140, 0, 0.1);
  }
  50% {
    box-shadow: 
      0 0 0 4px rgba(255, 140, 0, 0.3),
      0 0 0 8px rgba(255, 140, 0, 0.2),
      0 0 0 12px rgba(255, 140, 0, 0.1);
  }
}

/* Removed duplicate selectors */

/* Portal animations */
@keyframes portal-swirl {
  0% {
    transform: rotate(0deg);
  }
  100% {
    transform: rotate(360deg);
  }
}

/* Enhanced spinning portal effects */
@keyframes portal-outer-glow {
  0% {
    box-shadow: 
      0 0 15px 2px rgba(255, 140, 0, 0.5),
      0 0 30px 4px rgba(255, 140, 0, 0.3);
  }
  50% {
    box-shadow: 
      0 0 25px 4px rgba(255, 140, 0, 0.7),
      0 0 50px 8px rgba(255, 140, 0, 0.4);
  }
  100% {
    box-shadow: 
      0 0 15px 2px rgba(255, 140, 0, 0.5),
      0 0 30px 4px rgba(255, 140, 0, 0.3);
  }
}

/* Enhanced effects on hover */
.assemble-button:hover .portal-circle::before {
  box-shadow: 
    0 0 30px 5px rgba(255, 140, 0, 0.8),
    inset 0 0 40px 8px rgba(255, 140, 0, 0.6);
  animation: 
    portal-ring-spin 12s linear infinite, /* 4x slower than original hover */
    portal-outer-glow 12s infinite;
}

.assemble-button:hover .portal-circle::after {
  border-width: 3px;
  box-shadow: 
    inset 0 0 30px 8px rgba(255, 140, 0, 0.6),
    0 0 25px 5px rgba(255, 140, 0, 0.6);
  animation: portal-ring-spin-reverse 32s linear infinite; /* 4x slower */
}

/* Portal animation styles */

/* Simple button press effect without filling with orange */
.assemble-button:active {
  transform: scale(0.98);
}

/* Pulse ring effect on click - subtle notification */
@keyframes pulse-notification {
  0% {
    box-shadow: 0 0 0 0 rgba(255, 140, 0, 0.4);
  }
  70% {
    box-shadow: 0 0 0 20px rgba(255, 140, 0, 0);
  }
  100% {
    box-shadow: 0 0 0 0 rgba(255, 140, 0, 0);
  }
}

@keyframes portal-swirl-reverse {
  0% {
    transform: rotate(360deg);
  }
  100% {
    transform: rotate(0deg);
  }
}

@keyframes spark-flicker {
  0%, 20%, 40%, 60%, 80% {
    opacity: 0.2;
  }
  10%, 30%, 50%, 70%, 90% {
    opacity: 0.8;
  }
  100% {
    opacity: 0.5;
  }
}

/* Smoother, slower bouncing stone animations */
.bouncing-stone.space {
  animation: bounce-space 40s infinite ease-in-out;
}

.bouncing-stone.reality {
  animation: bounce-reality 45s infinite ease-in-out;
}

.bouncing-stone.power {
  animation: bounce-power 50s infinite ease-in-out;
}

.bouncing-stone.mind {
  animation: bounce-mind 48s infinite ease-in-out;
}

.bouncing-stone.time {
  animation: bounce-time 42s infinite ease-in-out;
}

.bouncing-stone.soul {
  animation: bounce-soul 46s infinite ease-in-out;
}

@keyframes bounce-space {
  0% { transform: translate(0, 0) rotate(0deg); }
  25% { transform: translate(-20vw, 15vh) rotate(90deg) scale(1.1); }
  50% { transform: translate(35vw, 30vh) rotate(180deg) scale(0.9); }
  75% { transform: translate(15vw, -25vh) rotate(270deg) scale(1.2); }
  100% { transform: translate(0, 0) rotate(360deg) scale(1); }
}

@keyframes bounce-reality {
  0% { transform: translate(0, 0) rotate(0deg); }
  20% { transform: translate(30vw, -20vh) rotate(72deg) scale(1.2); }
  40% { transform: translate(-25vw, -15vh) rotate(144deg) scale(0.9); }
  60% { transform: translate(-20vw, 25vh) rotate(216deg) scale(1.1); }
  80% { transform: translate(15vw, 20vh) rotate(288deg) scale(0.95); }
  100% { transform: translate(0, 0) rotate(360deg) scale(1); }
}

@keyframes bounce-power {
  0% { transform: translate(0, 0) rotate(0deg); }
  33% { transform: translate(-30vw, -20vh) rotate(120deg) scale(1.15); }
  66% { transform: translate(25vw, 30vh) rotate(240deg) scale(0.9); }
  100% { transform: translate(0, 0) rotate(360deg) scale(1); }
}

@keyframes bounce-mind {
  0% { transform: translate(0, 0) rotate(0deg); }
  25% { transform: translate(25vw, 25vh) rotate(90deg) scale(0.85); }
  50% { transform: translate(-30vw, 15vh) rotate(180deg) scale(1.2); }
  75% { transform: translate(-15vw, -30vh) rotate(270deg) scale(0.95); }
  100% { transform: translate(0, 0) rotate(360deg) scale(1); }
}

@keyframes bounce-time {
  0% { transform: translate(0, 0) rotate(0deg); }
  20% { transform: translate(-20vw, 30vh) rotate(72deg) scale(1.1); }
  40% { transform: translate(30vw, 10vh) rotate(144deg) scale(0.9); }
  60% { transform: translate(20vw, -25vh) rotate(216deg) scale(1.15); }
  80% { transform: translate(-25vw, -15vh) rotate(288deg) scale(0.95); }
  100% { transform: translate(0, 0) rotate(360deg) scale(1); }
}

@keyframes bounce-soul {
  0% { transform: translate(0, 0) rotate(0deg); }
  33% { transform: translate(25vw, -25vh) rotate(120deg) scale(1.05); }
  66% { transform: translate(-20vw, 20vh) rotate(240deg) scale(0.9); }
  100% { transform: translate(0, 0) rotate(360deg) scale(1); }
}

/* GPU acceleration for animations */
.bouncing-stone, .assemble-button {
  transform: translateZ(0);
  will-change: transform;
  backface-visibility: hidden;
}